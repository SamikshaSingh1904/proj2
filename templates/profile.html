{#
  profile.html
  Authors: Beatrix Kim, Bessie Li, Samiksha Singh
  Purpose:
    Display the logged-in user's profile: personal info,
    events they created, and events they attend.
#}
  
{% extends "base.html" %}
  
{% block main_content %}
<h1 class="visually-hidden">My Profile</h1>
<div class="profile-container">
  <div class="profile-header">
    <div class="profile-info">
      <div class="profile-avatar">
        {% if user.profile_filename %}
          <img class="profile-avatar-img"
              src="{{ url_for('profile_pic', uid=user.uid) -}}
                   ?v={{ user.profile_filename }}"
              alt="Profile photo">
        {% else %}
          {{ user.name[0].upper() }}
        {% endif %}
      </div>
      <div class="profile-details">
        <div class="profile-name">{{ user.name }}</div>
        <div class="profile-meta">
          <div class="profile-meta-item">
            ðŸ“§ {{ user.email }}
          </div>
          {% if user.year %}
          <div class="profile-meta-item">
            ðŸŽ“ Class of {{ user.year }}
          </div>
          {% endif %}
          {% if user.pronouns %}
          <div class="profile-meta-item">
            {{ user.pronouns }}
          </div>
          {% endif %}
        </div>
        {% if user.bio %}
        <div class="profile-bio">{{ user.bio }}</div>
        {% endif %}
        <div class="profile-actions">
          <a href="{{ url_for('edit_profile') }}" 
            class="profile-btn edit-btn">Edit Profile</a>
          <form id="delete-account-form"
                method="POST" 
                action="{{ url_for('delete_account') }}"
                style="display: inline;">
            <button type="submit" class="profile-btn delete-btn">
              Delete Account
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="events-section">
    <div class="section-header">
      <h2 class="section-title">
        My Events ({{ created_events|length }})
      </h2>
      {% if show_past_created %}
        <a href="{{ url_for('profile', show_past_joined=show_past_joined) }}"
          class="filter-btn">Show Upcoming Only
        </a>
      {% else %}
        <a href="{{ url_for(
            'profile', show_past_created='true', 
            show_past_joined=show_past_joined
          ) }}" 
          class="filter-btn">Show All Events
        </a>
      {% endif %}
    </div>

    {% if created_events %}
    <div class="event-list">
      {% for event in created_events %}
      <div class="event-item"
          data-event-url="{{ url_for(
            'view_event_forum', eid=event.eid) }}">
        <div class="event-item-header">
          <div class="event-item-title">
            {{ event.title }}
          </div>
          <span class="event-category-badge" 
                data-category="{{ event.category }}">
            {{ event.category }}
          </span>
        </div>
        <div class="event-item-info">
          ðŸ“… {{ event.date.strftime('%b %d, %Y') }}
          at {{ event.start_formatted }} â€¢
          ðŸ‘¥ {{ event.participant_count }}
          participant{{ 's'
            if event.participant_count != 1 else '' }}
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
      You haven't created any 
      {% if not show_past_created %}upcoming 
      {% endif %}events yet.
    </div>
    {% endif %}
  </div>

  <div class="events-section">
    <div class="section-header">
      <h2 class="section-title">
        Events I'm Attending ({{ joined_events|length }})
      </h2>
      {% if show_past_joined %}
        <a href="{{ url_for('profile', show_past_created=show_past_created) }}"
          class="filter-btn">Show Upcoming Only
        </a>
      {% else %}
        <a href="{{ url_for(
          'profile', show_past_created=show_past_created, 
          show_past_joined='true'
          ) }}" 
          class="filter-btn">Show All Events
        </a>
      {% endif %}
    </div>

    {% if joined_events %}
    <div class="event-list">
      {% for event in joined_events %}
      <div class="event-item"
          data-event-url="{{ url_for(
            'view_event_forum', eid=event.eid) }}">
        <div class="event-item-header">
          <div class="event-item-title">
            {{ event.title }}
          </div>
          <span class="event-category-badge" 
                data-category="{{ event.category }}">
            {{ event.category }}
          </span>
        </div>
        <div class="event-item-info">
          ðŸ“… {{ event.date.strftime('%b %d, %Y') }}
          at {{ event.start_formatted }} â€¢
          Created by {{ event.creator_name }}
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
      You haven't joined any 
      {% if not show_past_joined %}upcoming 
      {% endif %}events yet.
      <a href="{{ url_for('forum') }}">Browse events</a>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block end_scripts %}
<script src="{{ url_for('static',
                        filename='profile.js') }}">
</script>
{% endblock %}